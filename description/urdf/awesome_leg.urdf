<?xml version="1.0" encoding="utf-8" ?>

<!-- Leg base URDF (no external links) -->

<robot name="awesome_leg" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- ################### MATERIAL DEFINITIONS ################### -->

    <material name="sky_blue">
        <color rgba="0.13 0.44 0.70 1"/>
    </material>
    <material name="grey">
        <color rgba=" 0.6 0.6 0.6 1"/>
    </material>
    <material name="black">
        <color rgba="0.4 0.4 0.4 1"/>
    </material>
    <material name="brown">
        <color rgba="0.59 0.29 0.0 1"/>
    </material>
    
        <!-- ################### LINKS ################### -->
  
    <link name="pelvis">
        <inertial>
        <mass value="10.0"/> <!-- considering also the mass contribution of the robot torso -->
        <inertia ixx="0.00208333333333" ixy="0.0" ixz="0.0" iyy="0.00208333333333" iyz="0.0" izz="0.0025"/>
        </inertial>
        <visual>
        <geometry>
            <cylinder length="0.1" radius="0.1"/>
        </geometry>
        </visual>
        <visual>
        <geometry>
            <cylinder length="0.1" radius="0.1"/>
        </geometry>
        </visual>
    </link>

    <link name="hip1_1">
        <inertial>
        <origin xyz="0.010214199 0.0 0.038090987"/>
        <mass value="1.9194403"/>
        <!-- org: 2 -->
        <inertia ixx="0.0047439572" ixy="-0.0" ixz="-0.0003784138" iyy="0.0040551878" iyz="-0.0" izz="0.0034146219"/>
        <!-- <inertia ixx="0.01" ixy="0.01" ixz="0.01" iyy="0.01" iyz="0.01" izz="0.01"/> -->
        </inertial>
        <visual>
        <origin rpy="0.0 0.0 2.03221245002" xyz="0.0 0.0 0.0"/>
        <geometry>
            <mesh filename="package://awesome_leg_pholus/description/meshes/visual/hip-yaw.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="grey"/>
        </visual>
        <collision>
        <origin rpy="0.0 0.0 2.03221245002" xyz="0.0 0.0 0.0"/>
        <geometry>
            <mesh filename="package://awesome_leg_pholus/description/meshes/collision/hip-yaw.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        </collision>
    </link>

    <link name="hip2_1">
        <inertial>
        <origin xyz="2.57966e-05 0.1810266 0.085669756"/>
        <mass value="2.7264471"/>
        <!-- org: 4.5 -->
        <inertia ixx="0.04851869" ixy="-4.11894e-05" ixz="-1.68778e-05" iyy="0.004242055" iyz="0.0032243188" izz="0.04825583"/>
        <!-- <inertia ixx="0.01" ixy="0.01" ixz="0.01" iyy="0.01" iyz="0.01" izz="0.01"/> -->
        </inertial>
        <visual>
        <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
        <material name="sky_blue"/>
        <geometry>
            <mesh filename="package://awesome_leg_pholus/description/meshes/visual/hip-pitch.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        </visual>
        <collision>
        <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
        <geometry>
            <mesh filename="package://awesome_leg_pholus/description/meshes/collision/hip-pitch.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        </collision>
    </link>

    <link name="knee_1">
        <inertial>
        <mass value="1.1927236"/>
        <origin rpy="0.0 0.0 0.0" xyz="0.19572282 -0.014549221 -0.020785942"/>
        <!--origin xyz="${1.4549221e+01*mmTom} ${-2.0785942e+01*mmTom} ${-1.9572282e+02*mmTom}" rpy="0.0 0.0 0.0"/-->
        <!--inertia ixx="${3.5313402e+04*mm2Tom2}"  ixy="${0.0*mm2Tom2}"  ixz="${1.1029574e-01*mm2Tom2}" iyy="${3.5530025e+04*mm2Tom2}" iyz="${-6.0307457e+02*mm2Tom2}" izz="${1.3302597e+03*mm2Tom2}" /-->
        <inertia ixx="0.0013302597" ixy="0.00060307457" ixz="0.0" iyy="0.035313402" iyz="-1.1029574e-07" izz="0.035530025"/>
        </inertial>
        <visual>
        <origin rpy="1.57079632679 0 -1.57079632679" xyz="0 0 0"/>
        <material name="grey"/>
        <geometry name="1_stick_visual">
            <mesh filename="package://awesome_leg_pholus/description/meshes/visual/front_right_stick.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        </visual>
        <collision name="foot_tip_collision">
        <origin rpy="1.57079632679 0 -1.57079632679" xyz="0 0 0"/>
        <geometry name="1_stick_collision">
            <mesh filename="package://awesome_leg_pholus/description/meshes/collision/front_right_stick.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        </collision>
    </link>
    
    <link name="tip"/> <!-- just for reference-->

    <!-- ################### JOINTS ################### -->

    <joint name="hip_yaw_1" type="fixed">
        <parent link="pelvis"/>
        <child link="hip1_1"/>
        <origin rpy="3.14159265359 0.0 0.0" xyz="0.0 -0.0 -0.0566"/>
    </joint>

    <joint name="hip_pitch_1" type="revolute">
        <parent link="hip1_1"/>
        <child link="hip2_1"/>
        <origin rpy="1.57079632679 0.0 1.5707963268" xyz="0.0 0.0 0.0625"/>
        <axis xyz="0 0 1"/>
        <limit effort="112" lower="-2.0226" upper="2.02748" velocity="20.0"/>
    </joint>

    <joint name="knee_pitch_1" type="revolute">
        <parent link="hip2_1"/>
        <child link="knee_1"/>
        <origin rpy="3.14159265359 0.0 1.57079632679" xyz="0.0 0.3 -0.0036"/>
        <axis xyz="0 0 1"/>grey
        <limit effort="112" lower="-2.0226" upper="2.02748" velocity="20.0"/>
    </joint>
    
    <joint name="tip_joint" type="fixed">
        <parent link="knee_1"/>
        <child link="tip"/>
        <origin xyz="0.45 0.0 -0.02"/>
    </joint>
        
    <!-- ################### TRANSMISSION ELEMENTS ################### -->

   
    <transmission name="hip_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="hip_pitch_1">
            <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
        <actuator name="hip_motor">
            <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>
    <transmission name="knee_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="knee_pitch_1">
            <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
        <actuator name="knee_motor">
            <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
            <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>

    <!-- ################### MODEL PLUGINS ################### -->

    <gazebo> <!-- Gazebo-ROS control interface -->
        <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so"> 
            <robotNamespace>/awesome_leg</robotNamespace>
            <controlPeriod>0.01 </controlPeriod>
            <robotParam> /robot_description </robotParam> 
        </plugin>
    </gazebo>

    <!-- xbot2 joint device driver-->
    <gazebo>  
        <plugin name='xbot2_gz_joint_server' filename='libxbot2_gz_joint_server.so'> 
            <pid>

                <gain name="null_mode"  p="0"  d="0"/>
                <gain name="small_mot"  p="250"  d="5"/>
                <gain name="medium_mot" p="1000" d="10"/>
                <gain name="big_mot"    p="3000" d="10"/>

                <gain name="test_rig2HIP" profile="null_mode"/>
                <gain name="hip_actuation" profile="medium_mot"/>
                <gain name="knee_actuation" profile="medium_mot"/>
            </pid>
        </plugin>
    </gazebo>

    <gazebo> 
        <plugin name="xbot2_ft_driver" filename="libxbot2_gz_ft_server.so"/>
    </gazebo>

    <!-- <gazebo>
        <plugin name="xbot2_imu_driver" filename="libxbot2_gz_imu_server.so"/>
    </gazebo> -->

    

    <!-- ################### OTHER STUFF ################### -->

    <!--Gazebo-specific tags-->

    <gazebo reference="pelvis">
    <material>Gazebo/Grey  </material>
    </gazebo>
    <gazebo reference="hip1_1">
        <material>Gazebo/Grey   </material>
    </gazebo>
    <gazebo reference="hip2_1">
        <material>Gazebo/SkyBlue </material>
    </gazebo>
    <gazebo reference="knee_1">
        <material>Gazebo/Grey  </material>
        <!-- <sensor name='impact_sensor' type='contact'>
          <contact>
            <collision>knee_1_fixed_joint_lump__foot_tip_collision_collision</collision> <!--to check -->
            <topic>/awesome_leg/contact/</topic>
          </contact>
        </sensor> -->
    </gazebo>

        
  
  </robot>