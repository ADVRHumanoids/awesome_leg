#### Brief instructions on how to play with this docker:

- The code for the take-off and touchdown generation can be found, respectively, at `~/andreap_ws/src/awesome_leg/src/horizon_code/jump_generation.py` and `~/andreap_ws/src/awesome_leg/src/horizon_code/touchdown_opt.py`. 
  
   To reproduce the optimal solutions
    - make sure the config files in `~/andreap_ws/src/awesome_leg/config/horizon/jump_generation/jump_generation.yaml` and `awesome_leg/config/horizon/jump_generation/touchdown_opt.yaml` match the ones provided at  `/tmp/humanoids_opendata/opt_jumps/jump_generation_06-07-2023-14_24_01/horizon_config.yaml` and `/tmphumanoids_opendata/opt_landings/touchdown_opt_11-07-2023-12_25_45/touchdown_opt.yaml` (they should match by default).
    - at this point you should be able to run the take-off optimization with `python3 ~/andreap_ws/src/awesome_leg/src/horizon_code/jump_generation.py` and the touchdown optimization with `python3 ~/andreap_ws/src/awesome_leg/src/horizon_code/touchdown_opt.py`. Each of these scripts will dump the solutions in .mat files under the folders `/tmp/touchdown_opt_${date}-${time}` and `/tmp/jump_generation_${date}-${time}`, respectively. Please note you might experience slightly different convergence performance due to the absence of the MA57 library in the docker (MUMPS is used instead).

    To replay the optimal solutions run `python3 ~/andreap_ws/src/awesome_leg/src/rviz_traj_replayer.py -path /tmp/humanoids_opendata/opt_jumps/jump_generation_06-07-2023-14_24_01 -fname apex_awesome_jump_ref` for the take-off and `python3 ~/andreap_ws/src/awesome_leg/src/rviz_traj_replayer.py -path  /tmp/humanoids_opendata/opt_landings/touchdown_opt_11-07-2023-12_25_45 -fname energy_recov_ig` for the touchdown, respectively.
- To reproduce the plots shown in the paper, run the dedicates scripts under the folder `~/andreap_ws/src/awesome_leg/src/plot_generation`. E.g. `python3 ~/andreap_ws/src/awesome_leg/src/plot_generation/plot_solver_convergence.py`.
- To spawn a Gazebo simulation with the leg run `roslaunch awesome_leg gazebo.launch`. After that, the steps to replay the full takeoff + touchdown pipeline are the following: 
	- open another terminal and run `xbot2-core -S --hw sim`, which will launch the control interface. Note: you can ignore the loading error for `libxbotctrl_ec_ros.so`. 
	- open another terminal and run `xbot2-gui`. This will launch a GUI to interact with the robot and the control plugins
	- press the "start" button on the "bt_rt" line. This will start the main control plugin (handles the BehaviorTree) and all its childs.
	- in another terminal, start the jump sequence with `rosservice call /idler_rt/set_cmd_plugins_2idle "idle: false"`. This will start the full jumping pipeline. The leg will jump, land and then go back to the starting configuration. By default the leg will execute the optimal take-off and landing, but the landing and reorientation behaviour, as well as many other parameters, can be changed by modifying the configuration file at `~/andreap_ws/src/awesome_leg/config/xbot2/xbot2_energy_rec_com_express.yaml`. Data from the experiments are automatically dumped, for each control plugin, at `/tmp/humanoids_opendata/opt_jumps/jump_generation_06-07-2023-14_24_01`, where they can be inspected for debugging.
	- While the simulation is running, it's always possible to inspect in real-time most of the plugin data,  which are exposed via ROS topic. You can check them with `rostopic list` and  `rostopic echo` to the desired ones (or use a more advanced tool like Plotjuggler).
